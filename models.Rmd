---
title: "Models"
date: "`r Sys.Date()`"
output:
  html_document:
    toc: true
    toc_float: true
params:
  null_model: ""
  full_model: ""
  augmented_full_model_data: ""
  state_ranefs: ""
  full_model_with_three_way_interact: ""
---

```{r setup, include=FALSE}
knitr::opts_chunk$set()
```

```{r}
icc(null_model, by_group = TRUE)

tab_model(full_model, show.icc = TRUE)
```

```{r}
equatiomatic::extract_eq(full_model)
```

```{r}
tab_model(full_model_with_three_way_interact, show.icc = TRUE)
```

```{r label, options}
mod_d <- full_model@frame
```

```{r, eval = FALSE}

pred_frame <- data.frame(type_of_tweet = rep(c("non-ngsschat", 
                                               "ngsschat-chat", 
                                               "ngsschat-non-chat"), each = 2*11),
                         time_on_twitter = mean(mod_d$`scale(time_on_twitter)`),
                         isTeacher = rep(c(0, 1), 3*11),
                         year_of_post_centered = seq(-5, 5, 1),
                         hasJoinedChat = 0,
                         n_posted_chatsessions = mean(mod_d$`scale(n_posted_chatsessions)`, na.rm = T),
                         n_posted_ngsschat_nonchat = mean(mod_d$`scale(n_posted_ngsschat_nonchat)`, na.rm = T),
                         n_posted_non_ngsschat = mean(mod_d$`scale(n_posted_non_ngsschat)`, na.rm = T),
                         adopted_fct = factor("not-adopted",
                                              levels = c("not-adopted", "adopted", "missing")),
                         screen_name = -999
)
```

```{r, eval = FALSE}
pred_frame$prediction <- predict(full_model, newdata = pred_frame, allow.new.levels = TRUE)

label_frame <- data.frame(isTeacher = "Teachers",
                          year_of_post_centered = c(-2.95, 4.5, -3.5),
                          prediction = c(0.906, 1.003, 1.003),
                          type_of_tweet = c("non-ngsschat", 
                                            "ngsschat-chat", 
                                            "ngsschat-non-chat"),
                          label = c("Non-#NGSSchat",
                                    "#NGSSChat",
                                    "#NGSSChat non-chat"))
```

```{r, eval = FALSE}
extrafont::loadfonts()

curve_frame <- data.frame(
  x = c(2014.1, 2019.7, 2013.83),
  y = c(0.905, 1, 1),
  xend = c(2014.5, 2019, 2015.7),
  yend = c(0.955, 1.015, 0.998),
  isTeacher = "Teachers",
  type_of_tweet = c("non-ngsschat", "ngsschat-chat", "ngsschat-non-chat")
)

theme_set(theme_minimal(15))
pred_frame %>% 
  mutate(isTeacher = ifelse(isTeacher == 0, "Non-Teachers", "Teachers")) %>% 
  ggplot(aes(year_of_post_centered + 2016, prediction)) +
  geom_line(aes(color = type_of_tweet), 
            size = 1.3) +
  geom_text(aes(label = label),
            color = "#373B41",
            family = "Times New Roman",
            data = label_frame) +
  geom_curve(aes(x, y, xend = xend, yend = yend, color = type_of_tweet),
             data = curve_frame[1, ],
             size = 0.7,
             curvature = 0.5,
             arrow = arrow(length = unit(2, "mm"))) +
  geom_curve(aes(x, y, xend = xend, yend = yend, color = type_of_tweet),
           data = curve_frame[2, ],
           size = 0.7,
           curvature = -0.5,
           arrow = arrow(length = unit(2, "mm"))) +
  geom_curve(aes(x, y, xend = xend, yend = yend, color = type_of_tweet),
           data = curve_frame[3, ],
           size = 0.7,
           curvature = -0.5,
           arrow = arrow(length = unit(2, "mm"))) +
  facet_wrap(~isTeacher, ncol = 1) +
  scale_color_manual(values = c("#373B41", "#67E0CF", "#ABCFED")) +
  guides(color = "none") +
  scale_x_continuous("Year", breaks = seq(2010, 2020, 2)) +
  labs(x = "Year", 
       y = "Standardized Model-Predicted Sentiment Score") +
  theme(text = element_text(family = "Times New Roman"))

ggsave("interactions.png", width = 6.5, height = 8, dpi = 800)
```

```{r, eval= FALSE}
samp_d <- mod_d %>% 
  select(year_of_post_centered, 
         is_teacher, 
         type_of_tweet, 
         senti_scale_s) %>% 
  mutate(is_teacher = ifelse(is_teacher == 0, "Non-Teachers", "Teachers")) %>% 
  group_by(year_of_post_centered, is_teacher, type_of_tweet) %>% 
  slice_sample(prop = 0.1) 

pred_frame %>% 
  mutate(is_teacher = ifelse(is_teacher == 0, "Non-Teachers", "Teachers")) %>% 
  ggplot(aes(year_of_post_centered + 2016, prediction)) +
  geom_point(aes(year_of_post_centered + 2016, senti_scale_s),
             samp_d,
             color = "gray80") +
  geom_line(size = 1.3) +
  facet_grid(is_teacher ~ type_of_tweet)
```