---
title: "#NGSSchat sentiment modeling"
date: "`r Sys.Date()`"
output:
  html_document:
    toc: true
    toc_float: true
params:
  d: ""
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE, cache = FALSE)
knitr::clean_cache()
```

```{r, renaming-params}
d <- params$d
```

# Models

## Just modeling the effect of state

```{r, m0}
m0 <- lmer(senti_scale ~ 1 + (1|state_master), data = d)

sjPlot::tab_model(m0)

performance::icc(m0, by_group = TRUE)
```

```{r, m0-eq, results = "asis"}
equatiomatic::extract_eq(m0, wrap = TRUE)
```

## Just modeling the effect of screen_name

```{r, m1}
m1 <- lmer(senti_scale ~ 1 + 
             (1|screen_name), data = d)

sjPlot::tab_model(m1)

performance::icc(m1, by_group = TRUE)
```

```{r, m1-eq, results = "asis"}
equatiomatic::extract_eq(m1, wrap = TRUE)
```

## Modeling the effects of both state and screen name 

```{r, m2}
m2 <- lmer(senti_scale ~ 1 + 
             (1|state_master) + (1|screen_name), data = d)

sjPlot::tab_model(m2)

performance::icc(m2, by_group = TRUE)
```

```{r, m2-eq, results = "asis"}
equatiomatic::extract_eq(m2, wrap = TRUE)
```

## Adding whether the tweets incuded ngsschat or not

```{r, m3}
m3 <- lmer(senti_scale ~ 1 + type_of_tweet + 
             (1|state_master) + (1|screen_name), data = d)

sjPlot::tab_model(m3, show.icc = TRUE, show.ci = FALSE, show.se = TRUE)

performance::icc(m3, by_group = TRUE)
```

```{r, m3-eq, results = "asis"}
equatiomatic::extract_eq(m3, wrap = TRUE)
```

## Adding year as a factor

```{r, m4}
m4 <- lmer(senti_scale ~ 1 + type_of_tweet + year_fct + 
             (1|state_master) + (1|screen_name), data = d)

sjPlot::tab_model(m4, show.icc = TRUE, show.ci = FALSE, show.se = TRUE)

performance::icc(m4, by_group = TRUE)
```

```{r, m4-eq, results = "asis"}
equatiomatic::extract_eq(m4, wrap = TRUE)
```

## Adding year (centered) as a slope

also just trying out this technique for standardizing predictors

```{r, m5}
m5 <- lmer(senti_scale ~ 1 + type_of_tweet + year_of_post_centered + 
             (1|state_master) + (1|screen_name), data = d)

sjPlot::tab_model(m5, show.icc = TRUE, show.ci = FALSE, show.se = TRUE, show.std = "std2")

performance::icc(m5, by_group = TRUE)
```

```{r, m5-eq, results = "asis"}
equatiomatic::extract_eq(m5, wrap = TRUE)
```

## Modeling year as a quadratic curve

Not sure if this is the right way to do this; will also want to explore other forms, 
perhaps including those estimated with a GAM/spline.

```{r, m5i-slope}
m5i <- lmer(senti_scale ~ 1 + type_of_tweet + year_of_post_centered + I(year_of_post_centered^2) + 
              (1|state_master) + (1|screen_name), data = d)

sjPlot::tab_model(m5i, show.icc = TRUE, show.ci = FALSE, show.se = TRUE)

performance::icc(m5i, by_group = TRUE)
```

```{r, m5i-eq, results = "asis"}
equatiomatic::extract_eq(m5i, wrap = TRUE)
```

## Adding adoption status

```{r, m6}
m6 <- lmer(senti_scale ~ -1 + type_of_tweet + year_of_post_centered + adoption_key + lead + modified + time_on_twitter +
             (1|state_master) + (1|screen_name), data = d)

performance::icc(m6, by_group = TRUE)

sjPlot::tab_model(m6, show.icc = TRUE, show.ci = FALSE, show.se = TRUE)
```

```{r, m6-eq, results = "asis"}
equatiomatic::extract_eq(m6, wrap = TRUE)
```

## Adding others state-level vars

```{r, m7}
m7 <- lmer(senti_scale ~ 1 + year_of_post_centered + adoption_key + lead + modified + type_of_tweet + 
             (1|state_master) + (1|screen_name), data = d)

sjPlot::tab_model(m7, show.icc = TRUE, show.ci = FALSE, show.se = TRUE)

performance::icc(m7, by_group = TRUE)
```

```{r, m7-eq, results = "asis"}
equatiomatic::extract_eq(m7, wrap = TRUE)
```

## Adding teacher

```{r, m8}
m8 <- lmer(senti_scale ~ 1 + year_of_post_centered + adoption_key + lead + modified + type_of_tweet + isTeacher + 
             (1|state_master) + (1|screen_name), data = d)

sjPlot::tab_model(m8, show.icc = TRUE, show.ci = FALSE, show.se = TRUE)

performance::icc(m8, by_group = TRUE)
```

```{r, m8-eq, results = "asis"}
equatiomatic::extract_eq(m8, wrap = TRUE)
```

## Adding some tweet-level vars

```{r, m9, eval = TRUE}
m9 <- lmer(senti_scale ~ 1 + year_of_post_centered + adoption_key +  lead + modified + type_of_tweet + isTeacher + 
             favorite_count + retweet_count + reply_count +
             (1|state_master) + (1|screen_name), data = d)

sjPlot::tab_model(m9, show.icc = TRUE, show.ci = FALSE, show.se = TRUE)

performance::icc(m9, by_group = TRUE)
```

```{r, m9-eq, results = "asis", eval = TRUE}
equatiomatic::extract_eq(m9, wrap = TRUE)
```

## Adding some user-level vars

```{r, m10, eval = TRUE}
m10 <- lmer(senti_scale ~ 1 + year_of_post_centered + adoption_key + lead + modified + type_of_tweet + isTeacher + 
              favorite_count + retweet_count + reply_count +
              favorite_count_user +
              retweet_count_user +
              (1|state_master) + (1|screen_name), data = d)

sjPlot::tab_model(m10, show.icc = TRUE, show.ci = FALSE, show.se = TRUE)

performance::icc(m10, by_group = TRUE)
```

```{r, m10-eq, results = "asis", eval = TRUE}
equatiomatic::extract_eq(m10, wrap = TRUE)
```

## Adding additional user-level vars

```{r, m11, eval = TRUE}
m11 <- lmer(senti_scale ~ 1 + year_of_post_centered + adoption_key + lead + modified + type_of_tweet + isTeacher + 
              favorite_count + retweet_count + reply_count +
              favorite_count_user +
              retweet_count_user +
              statuses_count +
              followers_count +
              friends_count +
              (1|state_master) + (1|screen_name), data = d)

sjPlot::tab_model(m11, show.icc = TRUE, show.ci = FALSE, show.se = TRUE)

performance::icc(m11, by_group = TRUE)
```

## Adding new NGSS-related user-level vars

```{r, m12, eval = TRUE}
m12 <- lmer(senti_scale ~ 1 + year_of_post_centered + adoption_key + lead + modified + type_of_tweet + isTeacher + 
              favorite_count + retweet_count + reply_count +
              favorite_count_user +
              retweet_count_user +
              statuses_count +
              followers_count +
              friends_count +
              postedNGSSchat + postedChatSession + hasJoinedChat + total_n_chats +
              (1|state_master) + (1|screen_name), data = d)

sjPlot::tab_model(m12, show.icc = TRUE, show.ci = FALSE, show.se = TRUE)

performance::icc(m12, by_group = TRUE)
```

```{r, m12-eq, results = "asis", eval = TRUE}
equatiomatic::extract_eq(m12, wrap = TRUE)
```

## Adding random slope for a user-level variable

```{r, m13, eval = TRUE}
m13 <- lmer(senti_scale ~ 1 + year_of_post_centered + adoption_key + lead + modified + type_of_tweet + isTeacher + 
              favorite_count + retweet_count + reply_count +
              favorite_count_user +
              retweet_count_user +
              statuses_count +
              followers_count +
              friends_count +
              postedNGSSchat + postedChatSession + hasJoinedChat + scale(total_n_chats) +
              (1|state_master) + (hasJoinedChat|screen_name), data = d)

sjPlot::tab_model(m13, show.icc = TRUE, show.ci = FALSE, show.se = TRUE)

performance::icc(m13, by_group = TRUE)
```

```{r, m13-eq, results = "asis", eval = TRUE}
equatiomatic::extract_eq(m13, wrap = TRUE)
```

## Simple model with the new variables

```{r, m14, eval = TRUE}
m14 <- lmer(senti_scale ~ 1 + 
              postedNGSSchat + postedChatSession + hasJoinedChat + scale(total_n_chats) +
              (1|state_master) + (1|screen_name), data = d)

sjPlot::tab_model(m14, show.icc = TRUE, show.ci = FALSE, show.se = TRUE)

performance::icc(m14, by_group = TRUE)
```

```{r, m14-eq, results = "asis", eval = TRUE}
equatiomatic::extract_eq(m14, wrap = TRUE)
```