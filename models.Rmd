---
title: "Models"
date: "`r Sys.Date()`"
output:
  html_document:
    toc: true
    toc_float: true
params:
  null_model: ""
  full_model: ""
  augmented_full_model_data: ""
  state_ranefs: ""
---

```{r setup, include=FALSE}
knitr::opts_chunk$set()
```

```{r}
icc(null_model, by_group = TRUE)

tab_model(full_model, show.icc = TRUE)
```

```{r}
states_sf <- get_urbn_map("states", sf = TRUE)

state_ranefs <- rename(state_ranefs, state_name = level) %>% 
  mutate(state_name = tools::toTitleCase(state_name))

states_sf <- states_sf %>% 
  left_join(state_ranefs)
  
states_sf %>% 
  ggplot(aes(fill = estimate)) +
  geom_sf(color = "#ffffff") +
  # theme_minimal() +
  scale_fill_continuous("Random Effect Estimate") +
  theme(text = element_text(family = "Times"))
```

```{r label, options}
mod_d <- full_model@frame

pred_frame <- data.frame(type_of_tweet = rep(c("non-ngsschat", 
                                               "ngsschat-chat", 
                                               "ngsschat-non-chat"), each = 2*11),
                         time_on_twitter = mean(mod_d$`scale(time_on_twitter)`),
                         isTeacher = rep(c(0, 1), 3*11),
                         year_of_post_centered = seq(-5, 5, 1),
                         hasJoinedChat = 0,
                         n_posted_chatsessions = mean(mod_d$`scale(n_posted_chatsessions)`),
                         n_posted_ngsschat_nonchat = mean(mod_d$`scale(n_posted_ngsschat_nonchat)`),
                         n_posted_non_ngsschat = mean(mod_d$`scale(n_posted_non_ngsschat)`),
                         screen_name = -999
                         )
pred_frame$prediction <- predict(full_model, newdata = pred_frame, allow.new.levels = TRUE )

theme_set(theme_minimal(15))
ggplot(pred_frame, aes(year_of_post_centered + 2016, prediction)) +
  geom_line(aes(color = factor(type_of_tweet))) +
  facet_wrap(~isTeacher)
```

