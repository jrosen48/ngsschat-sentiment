---
title: "#NGSSchat sentiment: descriptive statistics"
date: "`r Sys.Date()`"
output:
  html_document:
    toc: true
    toc_float: true
params:
  d: ""
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE, cache = FALSE)
```

```{r, renaming-params}
d <- params$d
```

# Descriptive analysis

## Variables used in the analysis

q: search term used when downloading the data point, e.g. "#NGSSchat"
note: if a tweet was returned in multiple queries, the tweets are marked first
with "#NGSSchat", then "ngss" and then according to additional search
terms, such as "next generation science standards"

isChat: 1 if tweet was inside a #NGSSchat session, 0 if not, NA if #NGSSchat is not in 
the tweet

scale_pos, scale_neg: sentistrength sentiment rating from 1 to 5 and -5 to -1

scale_binary, scale_trinary: sentistrength categorial classification

senti_scale: scalepost + scale_neg + 5 -> sentiment scale from 1 to 9, 5 being neutral

time_on_twitter_seconds: time between post and account creation in seconds

time_on_twitter_period: more readable format in days-hours-minutes-seconds

lon, lat: geo coordinates Josh employed in the Google locations API, taken from
locations mentioned in user's bio

state_geocoding: coding of states by mentioned location in user's bio

state_introduction: coding of states by mentions of state names or acronyms by
users around 50 tweets before and 150 tweets after each start
of an #NGSSchat session
note: 1) the average #NGSSchat session is around 400 tweets long, thus the 
choice of tweet range as potential coding information
2) only unambiguous mentions of state names or acronyms were coded, thus
users mentioning both Texas and California were not included but
user mentioning Texas twice were

state_all_tweets: coding of states by mentions of state names or acronyms by users
at _any_ point of the data set and all search terms
note: 1) only unambiguous mentions of state names or acronyms were coded, thus
users mentioning both Texas and California were not included but
user mentioning Texas twice were

state_master: coding of states that combines the information of all three aforementioned
variables
note: geocoded states were prioritized, then NAs were first filled with states
coded from introductions and then remaining NAs were filled with states
mentioned in the whole data set

favourite_count_user, retweet_count_user: total sum of likes and retweet of the
author of each tweet (user-level variable)

isTeacher: prediction of classification algorithm whether post comes from a teacher (1)
or not (0), empty user bios were predicted as 0

postedNGSSchat: 1 if user ever posted a tweet with #NGSSchat, 0 if not

postedChatSession: 1 if user ever posted inside a #NGSSchat chat session, 0 if not

hasJoinedChat: 0 until user has posted inside a #NGSSchat chat session,
1 from the point of user's first tweet inside a #NGSSchat chat session on

total_n_chats: number of #NGSSchat chat sessions each user has participated in in total


```{r, desciptive-stats}
d %>% 
  select(type_of_tweet, year_fct, scale_neg, scale_pos, senti_scale, senti_binary, posemo, negemo, Analytic, cogproc, social, state_master, screen_name, year_of_post, near_adoption, before_adoption, after_adoption, no_adoption, favorite_count_user, retweet_count_user, followers_count, friends_count, time_on_twitter_period, reply_count, favorite_count, retweet_count, statuses_count, isTeacher, postedNGSSchat, postedChatSession, hasJoinedChat, total_n_chats) %>% 
  skimr::skim()
```

## Correlations

```{r, correlations}
d %>% 
  select(senti_scale, scale_neg, scale_pos, senti_binary, posemo, negemo, Analytic, cogproc, social, type_of_tweet, year_fct, state_master, screen_name, year_of_post, near_adoption, before_adoption, after_adoption, no_adoption, favorite_count_user, retweet_count_user, followers_count, friends_count, time_on_twitter_period, reply_count, favorite_count, retweet_count, statuses_count, isTeacher, postedNGSSchat, postedChatSession, hasJoinedChat, total_n_chats) %>% 
  select_if(is.numeric) %>% 
  corrr::correlate() %>% 
  corrr::fashion() %>%
  knitr::kable()
```

## Time series

```{r, ts-plot}
d %>% 
  mutate(date_r = lubridate::round_date(created_at, "day")) %>% 
  count(date_r) %>% 
  ggplot(aes(y = n, x = date_r)) +
  geom_line(color = 'lightgray') +
  geom_point(color = 'black') +
  hrbrthemes::theme_ipsum() +
  xlab(NULL) +
  ylab("Posts") +
  ggtitle("Posts to the #NGSSchat Hashtag on Twitter Per Day")

ggsave("img/ngsschat-posts-per-day.png", width = 8, height = 6)
```

## overall

```{r}
d %>% count(senti_binary) %>% 
  spread(senti_binary, n) %>% 
  set_names(c("neg", "pos")) %>% 
  mutate(senti_ratio = neg/pos)
```

## by year 

```{r}
d %>% count(year_of_post, senti_binary) %>% 
  spread(senti_binary, n) %>% 
  set_names(c("year_of_post", "neg", "pos")) %>%
  mutate(senti_ratio = neg/pos) %>% 
  ggplot(aes(x = year_of_post, y = senti_ratio)) +
  geom_point() +
  geom_line() +
  geom_smooth()
```

## by tweet type

```{r}
d %>% 
  count(type_of_tweet, senti_binary) %>% 
  spread(senti_binary, n) %>% 
  set_names(c("type_of_tweet", "neg", "pos")) %>% 
  mutate(senti_ratio = neg/pos)
```

## by state

```{r}
d %>% 
  count(state_master, senti_binary) %>% 
  spread(senti_binary, n) %>% 
  set_names(c("state_master", "neg", "pos")) %>% 
  mutate(senti_ratio = neg/pos) %>% 
  arrange(desc(senti_ratio)) %>% 
  ggplot(aes(x = reorder(state_master, senti_ratio), y = senti_ratio)) +
  geom_col() +
  coord_flip()
```

## by state, by year

```{r}
d %>% 
  filter(year_of_post >= 2012) %>% 
  count(state_master, year_of_post, senti_binary) %>% 
  spread(senti_binary, n) %>% 
  set_names(c("state_master", "year_of_post", "neg", "pos")) %>% 
  mutate(senti_ratio = neg/pos) %>% 
  arrange(desc(senti_ratio)) %>% 
  ggplot(aes(x = reorder(state_master, senti_ratio), y = senti_ratio)) +
  geom_col() +
  coord_flip() +
  facet_wrap(~year_of_post)
```

## by adoption status

```{r}
d %>% 
  count(adoption_key, senti_binary) %>% 
  spread(senti_binary, n) %>% 
  set_names(c("adoption_status", "neg", "pos")) %>% 
  mutate(senti_ratio = neg/pos) %>% 
  arrange(desc(senti_ratio))
```

## by adoption status by year

```{r}
d %>% 
  filter(year_of_post >= 2012) %>% 
  count(adoption_key, year_of_post, senti_binary) %>% 
  spread(senti_binary, n) %>% 
  set_names(c("state_master", "year_of_post", "neg", "pos")) %>% 
  mutate(senti_ratio = neg/pos) %>% 
  arrange(desc(senti_ratio)) %>% 
  ggplot(aes(x = reorder(state_master, senti_ratio), y = senti_ratio)) +
  geom_col() +
  coord_flip() +
  facet_wrap(~year_of_post)
```

## by teacher

```{r}
d %>% 
  filter(year_of_post >= 2012) %>% 
  count(isTeacher, senti_binary) %>% 
  spread(senti_binary, n) %>% 
  set_names(c("teacher", "neg", "pos")) %>% 
  mutate(senti_ratio = neg/pos) %>% 
  arrange(desc(senti_ratio))
```

## by whether someone posted to NGSSchat

```{r}
d %>% 
  filter(year_of_post >= 2012) %>% 
  count(postedNGSSchat, senti_binary) %>% 
  spread(senti_binary, n) %>% 
  set_names(c("postedNGSSchat", "neg", "pos")) %>% 
  mutate(senti_ratio = neg/pos) %>% 
  arrange(desc(senti_ratio))
```
