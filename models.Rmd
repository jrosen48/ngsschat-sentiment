---
title: "Models"
date: "`r Sys.Date()`"
output:
  html_document:
    toc: true
    toc_float: true
params:
  null_model: ""
  full_model: ""
  augmented_full_model_data: ""
  state_ranefs: ""
---

```{r setup, include=FALSE}
knitr::opts_chunk$set()
```

```{r}
icc(null_model, by_group = TRUE)

tab_model(full_model, show.icc = TRUE)
```

```{r label, options}
mod_d <- full_model@frame
levels(mod_d$adopted_fct)
pred_frame <- data.frame(type_of_tweet = rep(c("non-ngsschat", 
                                               "ngsschat-chat", 
                                               "ngsschat-non-chat"), each = 2*11),
                         time_on_twitter = mean(mod_d$`scale(time_on_twitter)`),
                         isTeacher = rep(c(0, 1), 3*11),
                         year_of_post_centered = seq(-5, 5, 1),
                         hasJoinedChat = 0,
                         n_posted_chatsessions = mean(mod_d$`scale(n_posted_chatsessions)`),
                         n_posted_ngsschat_nonchat = mean(mod_d$`scale(n_posted_ngsschat_nonchat)`),
                         n_posted_non_ngsschat = mean(mod_d$`scale(n_posted_non_ngsschat)`),
                         adopted_fct = factor("not-adopted",
                                              levels = c("not-adopted", "adopted", "missing")),
                         screen_name = -999
)

pred_frame$prediction <- predict(full_model, newdata = pred_frame, allow.new.levels = TRUE)

label_frame <- data.frame(isTeacher = "Teachers",
                          year_of_post_centered = c(-2.7, 4.7, -1.6),
                          prediction = c(-0.35, 0.23, 0.07),
                          type_of_tweet = c("non-ngsschat", 
                                               "ngsschat-chat", 
                                               "ngsschat-non-chat"),
                          label = c("Non-#NGSSchat",
                                    "Chat",
                                    "Non-Chat"))


loadfonts()

theme_set(theme_minimal(15))
pred_frame %>% 
  mutate(isTeacher = ifelse(isTeacher == 0, "Non-Teachers", "Teachers")) %>% 
  ggplot(aes(year_of_post_centered + 2016, prediction)) +
  geom_line(aes(color = type_of_tweet), 
            size = 1.3) +
  geom_text(aes(label = label, color = type_of_tweet), 
            family = "Times New Roman",
            data = label_frame) +
  facet_wrap(~isTeacher, ncol = 1) +
  scale_color_manual(values = c("#01959F", "#5D495A", "#E96058")) +
  guides(color = "none") +
  scale_x_continuous("Year", breaks = seq(2010, 2020, 2)) +
  scale_y_continuous("Standardized Model-Predicted Sentiment Score", 
                     breaks = seq(-0.5, 0.5, 0.2)) +
  labs(x = "Year", 
       y = "Standardized Model-Predicted Sentiment Score") +
  theme(text = element_text(family = "Times New Roman"))


ggsave("interactions.png", width = 6.5, height = 8, dpi = 800)
```

